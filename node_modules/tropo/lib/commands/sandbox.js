var log = require('winston');
var cli = require('../cli');
var colors = require('colors');

var conf = cli.config;

var run = function (arg, callback) {

    console.log(colors.red.bold('Running:', process.cwd()));

	var spawn = require('child_process').spawn,
	    app   = spawn('npm', ['start','--silent'], {
	    	env: {
	    		"PATH": process.env.PATH,
                "TROPO_TRANSPORT":"ws",
                "TROPO_SANDBOX_URL": process.env.TROPO_SANDBOX_URL || conf.get("tropoSandboxUrl") || "http://ws-proxy.connect.tropo.com",
                "TROPO_IN_CLOUD_FOUNDRY":true,
                "TROPO_RAYO_URL":false,
                "TROPO_APP_REVISION_ID":false,
                "TROPO_LOG_TIMESTAMPS": false,
                "TROPO_SANDBOX_USERNAME": conf.get("provisioningServerUsername"),
                "TROPO_SANDBOX_PASSWORD": conf.get("provisioningServerPassword"),
	    	},
            stdio: 'inherit'
	    });

};
exports.run = run;
