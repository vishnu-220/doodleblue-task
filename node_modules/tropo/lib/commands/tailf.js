var cli = require('../cli'),
	fs = require('fs'),
    util = require('util'),
    repo = require('../repo');


module.exports = function (arg, callback) {
	if (callback && typeof(callback) !== 'function') {
		callback = arguments[arguments.length - 1];
	}
	
	function doTail(id) {
		repo.Revisions.tailf(id, function (data) { 
			process.stdout.write(data);
		}, callback);
	}
	
	if (!arg) {
		var md = require('../metadata').load(false);
		if (md && md.package && md.package.tropo && md.package.tropo.uuid) {
			var params = {
				latestOnly: true,
				applicationUuid: md.package.tropo.uuid
			};
			repo.Revisions.list(params,function (err,data) {
				if (err) {
					return callback(err);
				} else if (data && data.length) {
					doTail(data[0].id);
				}
			});
		}
	} else {
		if (isNaN(parseInt(arg))) {
			return callback(new Error('invalid revision ID: ' + arg));
		}
		doTail(arg);
	}
	
};
