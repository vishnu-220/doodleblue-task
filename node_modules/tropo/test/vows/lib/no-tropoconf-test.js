
var assert = require('assert'),
    cli = require('../../../lib/cli'),
    fs = require('fs'),
    nock = require('nock'),
    path = require('path'),
    vows = require('vows');
    
var common = require('./common');



var dummyHost = 'http://api.example.com';
var basePath = '/repo';

var makeTopic = common.makeTopic;
var makeTest = common.makeTest;

vows.describe('lib/cli').addBatch({
    'emptyconf' : makeTest({
    	confpath : path.join(process.env.TMPDIR, 'empty-tropoconf'),
        argv : ['apps','list'],
		setup : function() {
			fs.writeFileSync(this.confpath, '{}');

			var conf = cli.config;
			conf.stores.file.file = this.confpath;
			conf.stores.file.loadSync();

			var prompt = require('prompt');
			prompt.override = {}
            prompt.override.repo = dummyHost + basePath;
            prompt.override.username = 'foo';
            prompt.override.password = 'foo';
            prompt.override.signup = 'N';

            nock(dummyHost)
                .get(basePath + '/revisions')
                .reply(200, { 
                    results : []
                });
        },
        cleanup : function() {
        	try {
        		fs.unlinkSync(this.confpath);
        	} catch (ex) {
        		console.log('err',ex);
        		// ignore
        	}
        }
    })
}).export(module);
